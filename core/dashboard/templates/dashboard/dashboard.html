{% load custom_filters %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
  body {
    margin: 0;
    height: 100vh;
    overflow: auto;
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 110px;
    background-color: #111;
    display: none;
  }

  @media (min-width: 768px) {
    .sidebar {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      z-index: 1000;
    }

    #main-body {
      margin-left: 110px;
    }
  }

  .sidebar-logo {
    width: 70px;
    height: 65px;
    object-fit: contain;
    margin-bottom: 1rem;
  }

  .sidebar-icons {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    flex-grow: 1;
    margin-top: 1rem;
  }

  .sidebar-icon {
    color: white;
    font-size: 1.6rem;
    transition: color 0.3s;
  }

  .sidebar-icon:hover {
    color: #0d6efd;
  }

  .sidebar-footer {
    margin-bottom: 1rem;
  }
</style>

</head>
<body>
  <div>
   <nav class="navbar navbar-expand-md mt-2 me-1 d-md-none">
    <div class="container-xl">
      <a href="Index.html"class="navbar-brand">
             <img src="{% static 'logo.PNG'%}" alt="" class="img-fluid" style="width: 70px; height: 65px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" 
        data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false" 
        aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span></button>


        <div class="collapse navbar-collapse justify-content-end align-content-center text-center"
         id="main-nav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link  fw-bold" href="{% url 'homepage' %}">Home</a></li>
                <li class="nav-item"><a class="nav-link  fw-bold" href="{% url 'dashboard' %}">Dashboard</a></li>
                <li class="nav-item"><a class="nav-link  fw-bold" href="{% url 'analytics' %}">Analytics</a></li>
                <li class="nav-item"><a class="nav-link  fw-bold" href="{% url 'profile' %}">Profile</a></li>
                <li class="nav-item">
                  <form action="/accounts/logout" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn fw-bold text-light" style="background-color: #0d3336; ">Sign Out</button>
                  </form>
                </li>

            </ul>
        </div>
     </div>
    </nav>
    <!-- Sidebar -->
     <!-- Sidebar -->
<div class="sidebar d-none d-md-flex">
  <!-- Top: Logo -->
  <div>
      <a href="{% url 'homepage' %}"class="navbar-brand">
             <img src="{% static 'logo.PNG'%}" alt="" class="img-fluid" style="width: 70px; height: 65px;">
             <p class="text-light">CreditGrid</p>  
      </a>
  </div>

  <!-- Middle: Icons -->
  <div class="sidebar-icons mt-4">
    <a href="{% url 'dashboard' %}" class="sidebar-icon" title="Dashboard">
      <i class="bi bi-speedometer2"></i>
    </a>
    <div class="my-2"></div>
    <a href="{% url 'analytics' %}" class="sidebar-icon" title="Analytics">
          <i class="bi bi-graph-up-arrow"></i>
        </a>
    <div class="my-2"></div>
    <a href="{% url 'profile' %}" class="sidebar-icon" title="Profile">
      <i class="bi bi-person"></i>
    </a>
  </div>

  <!-- Bottom: Logout (optional) -->
  <div class="sidebar-footer">
    <form action="/accounts/logout" method="post">
      {% csrf_token %}
      <button type="submit" class="btn btn-sm btn-outline-light">
        <i class="bi bi-box-arrow-right"></i>
      </button>
    </form>
  </div>
</div>
    <div class="container flex-grow-1" id="main-body">
    <div class="container m-1 mt-2">
      <h3 class="fw-bold d-5">Hello {{user.first_name}}</h3>
      <p><small class="text-muted">Portfolio Summary</small></p>
    </div>
  <div class="container m-1">
    <div class="row justify-content-between">
      <div class="col-6 col-md-4 col-lg-3">
        <div class="card p-2 border-2 rounded-4" style="background-color: #e5f1fd;">
          <p class="text-center fw-bold">TOTAL OUTSTANDING AMOUNT</p>
          <p class="fw-bold text-center fs-2">k{{total_outstanding_amount}}</p>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3">
         <div class="card p-3 border-2 rounded-4" style="background-color: #e3ddef;">
          <p class="fw-bold text-center">TOTAL DISBURSED AMOUNT</p>
          <p class="fw-bold text-center fs-2">k{{total_disbursed_amount}}</p>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3">
        <div class="mt-4 d-md-none"></div>
         <div class="card p-3 border-2 rounded-4" style="background-color: #d6edd9;">
          <p class="fw-bold text-center">INTEREST EARNED</p>
          <p class="fw-bold text-center fs-2">k{{total_interest_earned}}</p>
        </div>
      </div>
      <div class="col-6 col-md-4 col-lg-3">
        <div class="mt-4 d-md-none"></div>
        <a href="{% url 'transactions' %}" style="text-decoration: none;">
          <div class="card p-3 border-2 rounded-4" style="background-color: #f6f0d8;">
            <p class="fw-bold text-center">ACTIVE LOANS</p>
            <p class="fw-bold text-center fs-2">{{active_loans}}</p>
        </div>
        </a>
      </div>
    </div>
  </div>
  <div class="container mt-3 ms-3">
    <div class="row">
      <div class="col-6">
       <button type="button" class="btn text-light" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style="background-color: #111;">
          Add Borrower
      </button> 
    <p class="mt-2">
      <small class="text-muted">Upcoming Due Transactions</small>
    </p>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header d-flex justify-content-center">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">New Borrower</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div>
          <form method="POST" action=".">
              {% csrf_token %}
            <input type="text" placeholder="Full Name" name="name" class="mb-2" value="{{form.name.value}}"><br>
             {% for error in form.name.error %}
             <div class="text-danger"> {{error}}</div>
             {% endfor %}
            <input type="number" placeholder="Disbursed Amount" name="amount" class="mb-2" value="{{form.amount.value}}"><br>
            {% for error in form.amount.error %}
             <div class="text-danger"> {{error}}</div>
             {% endfor %}
            <input type="number" placeholder="Interest Rate" name="interest" class="mb-2" value="{{form.interest.value}}"><br>
            {% for error in form.interest.error %}
             <div class="text-danger"> {{error}}</div>
             {% endfor %}
            <input type="date" placeholder="Due Date" name="date" class="mb-2" value="{{form.date.value}}"><br>
            {% for error in form.date.error%}
             <div class="text-danger"> {{error}}</div>
             {% endfor %}
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
    <div class="row">
      <div class="col-11 col-md-6 col-lg-6">
        <div class="table-responsive" style="overflow-y: auto;">
          <table class="table table-striped">
            <thead class="table dark">
               <tr>
                  <th>Name</th>
                  <th>Amount Due</th>
                  <th>Due Date</th>
               </tr>
            </thead>
            <tbody>
             {% for borrower in due_soon_borrowers %}
              <tr onclick="window.location.href='{% url 'borrower_detail' borrower.id %}'" style="cursor: pointer;">
                <td>{{ borrower.name }}</td>
                <td>k{{ borrower.amount_due }}</td>
                <td>{{ borrower.date }}</td>
              </tr>
             {% empty %}
              <tr>
            <td colspan="5">No upcoming dues.</td>
          </tr>
        {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-6 d-none d-md-block">
        <canvas id="interestChart"></canvas>
      </div>
    </div>
  </div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = {{ interest_amount_labels_json|safe }};
  const interestData = {{ interest_amount_data_json|safe }};

  const interestChart = new Chart(document.getElementById('interestChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Interest Earned',
        data: interestData,
        borderColor: 'green',
        fill: false,
        tension: 0.2
      }]
    }
  });
</script>
</body>
</html>